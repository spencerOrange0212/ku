name: 自動打包 EXE 發布

# 觸發條件：當您推送開頭是 "v" 的標籤 (例如 v1.0, v2.1) 時觸發
on:
  push:
    tags:
      - 'v*'

jobs:
  build:
    runs-on: windows-latest # 指定使用 Windows 電腦打包

    steps:
    # 1. 下載您的程式碼
    - name: Checkout code
      uses: actions/checkout@v3

    # 2. 設定 Python 環境 (這裡設為 3.10 或您目前使用的版本)
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    # 3. 安裝您需要的套件
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        pip install pyinstaller

    # 4. 執行 PyInstaller 打包 (使用您的 spec 檔)
    - name: Build EXE
      run: pyinstaller --clean 科餘自動化工具.spec

    # 5. 將 dist 裡面的資料夾壓縮成 ZIP (方便使用者下載)
    # 注意：這裡的資料夾名稱要對應您 spec 檔裡面的 name
    - name: Zip the Build
      run: |
        cd dist
        Compress-Archive -Path "科餘自動化工具_*" -DestinationPath "KuTool_Release.zip"

    # 6. 發布到 GitHub Releases
    - name: Create Release
      uses: softprops/action-gh-release@v1
      if: startsWith(github.ref, 'refs/tags/')
      with:
        files: dist/KuTool_Release.zip
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}